{% load static %}
<!doctype html>
<html lang="en" data-bs-theme="blue-theme">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SerpAPI Trends | Form Wizard</title>
  <!--favicon-->
	<link rel="icon" href="{% static 'images/favicon-32x32.png' %}" type="image/png">
  <!-- loader-->
	<link href="{% static 'css/pace.min.css' %}" rel="stylesheet">
	<script src="{% static 'js/pace.min.js' %}"></script>

  <!--plugins-->
  <link href="{% static 'plugins/perfect-scrollbar/css/perfect-scrollbar.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/metismenu/metisMenu.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/metismenu/mm-vertical.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/simplebar/css/simplebar.css' %}">
  <link href="{% static 'plugins/perfect-scrollbar/css/perfect-scrollbar.css' %}" rel="stylesheet">
  <link href="{% static 'plugins/bs-stepper/css/bs-stepper.css' %}" rel="stylesheet">
  <!--bootstrap css-->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Material+Icons+Outlined" rel="stylesheet">
  <!--main css-->
  <link href="{% static 'css/bootstrap-extended.css' %}" rel="stylesheet">
  <link href="{% static 'css/main.css' %}" rel="stylesheet">
  <link href="{% static 'css/dark-theme.css' %}" rel="stylesheet">
  <link href="{% static 'css/blue-theme.css' %}" rel="stylesheet">
  <link href="{% static 'css/semi-dark.css' %}" rel="stylesheet">
  <link href="{% static 'css/bordered-theme.css' %}" rel="stylesheet">
  <link href="{% static 'css/responsive.css' %}" rel="stylesheet">

  <!-- jQuery UI CSS for autocomplete -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

  <!-- Custom styles for charts and autocomplete -->
  <style>
    .chart-container {
      position: relative;
      margin: auto;
      height: 350px;
      width: 100%;
    }

    #chartTypeSelector {
      max-width: 300px;
    }

    /* Add some animation for chart transitions */
    .chart-container {
      transition: opacity 0.3s ease-in-out;
    }

    /* Autocomplete styles */
    .ui-autocomplete {
      max-height: 200px;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 9999 !important;
      border-radius: 0 0 4px 4px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .ui-menu-item {
      padding: 8px 12px;
      border-bottom: 1px solid #f3f3f3;
    }

    .ui-menu-item:hover {
      background-color: #f8f9fa;
      cursor: pointer;
    }

    .ui-state-active,
    .ui-widget-content .ui-state-active {
      background-color: #0d6efd !important;
      border-color: #0d6efd !important;
      color: white !important;
    }

    .ui-helper-hidden-accessible {
      display: none;
    }
  </style>

</head>

<body>

  <!--start header-->
  <header class="top-header">
    <nav class="navbar navbar-expand align-items-center gap-4">
      <div class="btn-toggle">
        <a href="javascript:;"><i class="material-icons-outlined">menu</i></a>
      </div>
      <div class="search-bar flex-grow-1">
        <div class="position-relative">
          <input class="form-control rounded-5 px-5 search-control d-lg-block d-none" type="text" placeholder="Search">
          <span class="material-icons-outlined position-absolute d-lg-block d-none ms-3 translate-middle-y start-0 top-50">search</span>
          <span class="material-icons-outlined position-absolute me-3 translate-middle-y end-0 top-50 search-close">close</span>
          <div class="search-popup p-3">
            <div class="card rounded-4 overflow-hidden">
              <div class="card-header d-lg-none">
                <div class="position-relative">
                  <input class="form-control rounded-5 px-5 mobile-search-control" type="text" placeholder="Search">
                  <span class="material-icons-outlined position-absolute ms-3 translate-middle-y start-0 top-50">search</span>
                  <span class="material-icons-outlined position-absolute me-3 translate-middle-y end-0 top-50 mobile-search-close">close</span>
                 </div>
              </div>
              <div class="card-body search-content">
                <p class="search-title">Recent Searches</p>
                <div class="d-flex align-items-start flex-wrap gap-2 kewords-wrapper">
                  <a href="javascript:;" class="kewords"><span>Angular Template</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                  <a href="javascript:;" class="kewords"><span>Dashboard</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                  <a href="javascript:;" class="kewords"><span>Admin Template</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                  <a href="javascript:;" class="kewords"><span>Bootstrap 5 Admin</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                  <a href="javascript:;" class="kewords"><span>Html eCommerce</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                  <a href="javascript:;" class="kewords"><span>Sass</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                  <a href="javascript:;" class="kewords"><span>laravel 9</span><i
                      class="material-icons-outlined fs-6">search</i></a>
                </div>
                <hr>
                <p class="search-title">Tutorials</p>
                <div class="search-list d-flex flex-column gap-2">
                  <div class="search-list-item d-flex align-items-center gap-3">
                    <div class="list-icon">
                      <i class="material-icons-outlined fs-5">play_circle</i>
                    </div>
                    <div class="">
                      <h5 class="mb-0 search-list-title ">Wordpress Tutorials</h5>
                    </div>
                  </div>
                  <div class="search-list-item d-flex align-items-center gap-3">
                    <div class="list-icon">
                      <i class="material-icons-outlined fs-5">shopping_basket</i>
                    </div>
                    <div class="">
                      <h5 class="mb-0 search-list-title">eCommerce Website Tutorials</h5>
                    </div>
                  </div>

                  <div class="search-list-item d-flex align-items-center gap-3">
                    <div class="list-icon">
                      <i class="material-icons-outlined fs-5">laptop</i>
                    </div>
                    <div class="">
                      <h5 class="mb-0 search-list-title">Responsive Design</h5>
                    </div>
                  </div>
                </div>

              </div>
              <div class="card-footer text-center bg-transparent">
                <a href="javascript:;" class="btn w-100">See All Search Results</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ul class="navbar-nav gap-1 nav-right-links align-items-center">
        <li class="nav-item d-lg-none mobile-search-btn">
          <a class="nav-link" href="javascript:;"><i class="material-icons-outlined">search</i></a>
        </li>




        <li class="nav-item dropdown">

          <div class="dropdown-menu dropdown-notify dropdown-menu-end shadow">
            <div class="px-3 py-1 d-flex align-items-center justify-content-between border-bottom">

              <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle dropdown-toggle-nocaret option" type="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <span class="material-icons-outlined">
                    more_vert
                  </span>
                </button>

              </div>
            </div>
            <div class="notify-list">

              <div>
                <a class="dropdown-item border-bottom py-2" href="javascript:;">
                  <div class="d-flex align-items-center gap-3">
                    <div class="user-wrapper bg-primary text-primary bg-opacity-10">
                      <span>RS</span>
                    </div>
                    <div class="">
                      <h5 class="notify-title">New Account Created</h5>
                      <p class="mb-0 notify-desc">From USA an user has registered.</p>
                      <p class="mb-0 notify-time">Yesterday</p>
                    </div>
                    <div class="notify-close position-absolute end-0 me-3">
                      <i class="material-icons-outlined fs-6">close</i>
                    </div>
                  </div>
                </a>
              </div>
              <div>
                <a class="dropdown-item border-bottom py-2" href="javascript:;">
                  <div class="d-flex align-items-center gap-3">
                    <div class="">
                      <img src="{% static 'images/apps/13.png' %}" class="rounded-circle" width="45" height="45" alt="">
                    </div>
                    <div class="">
                      <h5 class="notify-title">Payment Recived</h5>
                      <p class="mb-0 notify-desc">New payment recived successfully</p>
                      <p class="mb-0 notify-time">1d ago</p>
                    </div>
                    <div class="notify-close position-absolute end-0 me-3">
                      <i class="material-icons-outlined fs-6">close</i>
                    </div>
                  </div>
                </a>
              </div>
              <div>
                <a class="dropdown-item border-bottom py-2" href="javascript:;">
                  <div class="d-flex align-items-center gap-3">
                    <div class="">
                      <img src="{% static 'images/apps/14.png' %}" class="rounded-circle" width="45" height="45" alt="">
                    </div>
                    <div class="">
                      <h5 class="notify-title">New Order Recived</h5>
                      <p class="mb-0 notify-desc">Recived new order from michle</p>
                      <p class="mb-0 notify-time">2:15 AM</p>
                    </div>
                    <div class="notify-close position-absolute end-0 me-3">
                      <i class="material-icons-outlined fs-6">close</i>
                    </div>
                  </div>
                </a>
              </div>
              <div>
                <a class="dropdown-item border-bottom py-2" href="javascript:;">
                  <div class="d-flex align-items-center gap-3">
                    <div class="">
                      <img src="https://placehold.co/110x110/png" class="rounded-circle" width="45" height="45" alt="">
                    </div>
                    <div class="">
                      <h5 class="notify-title">Congratulations Jhon</h5>
                      <p class="mb-0 notify-desc">Many congtars jhon. You have won the gifts.</p>
                      <p class="mb-0 notify-time">Today</p>
                    </div>
                    <div class="notify-close position-absolute end-0 me-3">
                      <i class="material-icons-outlined fs-6">close</i>
                    </div>
                  </div>
                </a>
              </div>
              <div>
                <a class="dropdown-item py-2" href="javascript:;">
                  <div class="d-flex align-items-center gap-3">
                    <div class="user-wrapper bg-danger text-danger bg-opacity-10">
                      <span>PK</span>
                    </div>
                    <div class="">
                      <h5 class="notify-title">New Account Created</h5>
                      <p class="mb-0 notify-desc">From USA an user has registered.</p>
                      <p class="mb-0 notify-time">Yesterday</p>
                    </div>
                    <div class="notify-close position-absolute end-0 me-3">
                      <i class="material-icons-outlined fs-6">close</i>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </li>

        <li class="nav-item dropdown">
          <a href="javascrpt:;" class="dropdown-toggle dropdown-toggle-nocaret" data-bs-toggle="dropdown">
             <img src="https://placehold.co/110x110/png" class="rounded-circle p-1 border" width="45" height="45" alt="">
          </a>
          <div class="dropdown-menu dropdown-user dropdown-menu-end shadow">
            <a class="dropdown-item  gap-2 py-2" href="javascript:;">
              <div class="text-center">
                <img src="https://placehold.co/110x110/png" class="rounded-circle p-1 shadow mb-3" width="90" height="90"
                  alt="">
                <h5 class="user-name mb-0 fw-bold">Hello, {{ user.username }}</h5>
              </div>
            </a>
            <hr class="dropdown-divider">
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
              {% csrf_token %}
              <button type="submit" class="dropdown-item d-flex align-items-center gap-2 py-2">
                <i class="material-icons-outlined">power_settings_new</i>Logout
              </button>
            </form>
          </div>
        </li>
      </ul>
    </nav>
  </header>
  <!--end top header-->


  <!--start sidebar-->
  <aside class="sidebar-wrapper" data-simplebar="true">
    <div class="sidebar-header">
      <div class="logo-icon">
        <img src="{% static 'images/logo-icon.png' %}" class="logo-img" alt="">
      </div>
      <div class="logo-name flex-grow-1">
        <h5 class="mb-0 ">SerpAPI Trends</h5>
      </div>
      <div class="sidebar-close">
        <span class="material-icons-outlined">close</span>
      </div>
    </div>
    <div class="sidebar-nav">
        <!--navigation-->
        <ul class="metismenu" id="sidenav">
          <li>
            <a href="javascript:;" class="has-arrow">
              <div class="parent-icon"><i class="material-icons-outlined">home</i>
              </div>
              <div class="menu-title">Dashboard</div>
            </a>
            <ul>
              <li><a href="index.html"><i class="material-icons-outlined">arrow_right</i>Analysis</a>
              </li>
            </ul>
          </li>
          <li class="menu-label">UI Elements</li>
          <li>
            <a href="cards.html">
              <div class="parent-icon"><i class="material-icons-outlined">inventory_2</i>
              </div>
              <div class="menu-title">Cards</div>
            </a>
          </li>


          <li class="menu-label">Others</li>

          <li>
            <a href="javascrpt:;">
              <div class="parent-icon"><i class="material-icons-outlined">support</i>
              </div>
              <div class="menu-title">Support</div>
            </a>
          </li>
         </ul>
        <!--end navigation-->
    </div>
  </aside>
<!--end sidebar-->


  <!--start main wrapper-->
  <main class="main-wrapper">
    <div class="main-content">
      <!--breadcrumb-->
				<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
					<div class="breadcrumb-title pe-3">Components</div>
					<div class="ps-3">
						<nav aria-label="breadcrumb">

						</nav>
					</div>
					<div class="ms-auto">
						<!-- Settings button removed -->
					</div>
				</div>
				<!--end breadcrumb-->



        <!--start stepper one-->

        <h6 class="text-uppercase">Non Linear</h6>
        <hr>
				<div id="stepper1" class="bs-stepper">
				  <div class="card">

					<div class="card-header">
						<div class="d-lg-flex flex-lg-row align-items-lg-center justify-content-lg-between" role="tablist">
							<div class="step" data-target="#test-l-1">
							  <div class="step-trigger" role="tab" id="stepper1trigger1" aria-controls="test-l-1">
								<div class="bs-stepper-circle"></div>
								<div class="">
									<h5 class="mb-0 steper-title">Search for trends</h5>

								</div>
							  </div>
							</div>

						  </div>
					 </div>
				    <div class="card-body">
					  <div class="bs-stepper-content">
						<form method="post" action="{% url 'search_trends' %}" id="trends-form">
						  {% csrf_token %}
						  <div id="test-l-1" role="tabpanel" class="bs-stepper-pane active dstepper-block" aria-labelledby="stepper1trigger1">
							<h5 class="mb-1">Search Trends with SerpAPI (Demo Mode)</h5>
							<p class="mb-4">Enter search terms and select a region to explore search trends data. Currently using demo data.</p>
							{% if error %}
							<div class="alert alert-danger" role="alert">
								<pre style="white-space: pre-wrap;">{{ error }}</pre>
							</div>
							{% endif %}

							{% if searches_left is not None %}
							<div class="alert {% if searches_left <= 1 %}alert-danger{% elif searches_left <= 2 %}alert-warning{% else %}alert-info{% endif %} mb-4">
								<div class="d-flex justify-content-between align-items-center">
									<div>
										<strong>Search Limit:</strong> You have used {{ search_count }} of {{ max_searches }} searches.
										{% if searches_left <= 0 %}
										<span class="d-block mt-1">You've reached your search limit. Please upgrade your plan to continue searching.</span>
										{% elif searches_left == 1 %}
										<span class="d-block mt-1">You have only 1 search remaining. Consider upgrading your plan.</span>
										{% else %}
										<span class="d-block mt-1">You have {{ searches_left }} searches remaining.</span>
										{% endif %}
									</div>
									<a href="{% url 'pricing_page' %}" class="btn btn-primary">Buy Plan</a>
								</div>
							</div>
							{% endif %}

							<div class="row g-3">
								<div class="col-12 col-lg-6">
									<label class="form-label">Search Term</label>
									<div class="position-relative">
										<input type="text" class="form-control" name="search_term" id="search_term" placeholder="Enter keyword or topic" autocomplete="off">
										<div id="search_suggestions" class="search-suggestions"></div>
									</div>
								</div>
								<div class="col-12 col-lg-6">
									<label for="region" class="form-label">Select Region</label>
									<select class="form-select" id="region" name="region" data-placeholder="Choose a region">
										<option value="GLOBAL">Global</option>
										<option value="US">United States</option>
										<option value="GB">United Kingdom</option>
										<option value="FR">France</option>
										<option value="DE">Germany</option>
										<option value="IT">Italy</option>
										<option value="TN">Tunisia</option>
										<option value="CA">Canada</option>
										<option value="AU">Australia</option>
									</select>
								</div>

								<div class="col-12 col-lg-6">
									<label for="time_range" class="form-label">Time Range</label>
									<select class="form-select" id="time_range" name="time_range">
										<option value="today 1-m">Past month</option>
										<option value="today 3-m">Past 3 months</option>
										<option value="today 12-m">Past year</option>
										<option value="today 5-y">Past 5 years</option>
										<option value="all">All time</option>
									</select>
								</div>

								<div class="col-12 col-lg-6">
									<label for="category" class="form-label">Platform</label>
									<select class="form-select" id="category" name="category">
										<option value="0">All platforms (web)</option>
										<option value="5">Web</option>
										<option value="7">News</option>
										<option value="12">Images</option>
										<option value="20">YouTube</option>
										<option value="30">Shopping</option>
									</select>
								</div>

								<div class="col-12">
									<button type="submit" class="btn btn-grd-primary px-4">Search Trends <i class="material-icons-outlined">trending_up</i></button>
								</div>
							</div><!---end row-->

						  </div>
						</form>
					  </div>

					</div>
				   </div>
				 </div>
				<!--end stepper one-->

				{% if has_results %}
				<!-- Search Trends Results Section -->
				<div class="card mt-4">
					<div class="card-header">
						<h5 class="mb-0">Demo Results for "{{ search_term }}"</h5>
						<p class="mb-0">Region: {{ region }} | Time Range: {{ time_range }} | <span class="badge bg-warning">Demo Data</span></p>
					</div>
					<div class="alert alert-info mx-3 mt-3">
						<strong>Note:</strong> This is currently showing dynamically generated demo data based on your search term and region.
						Different combinations of search terms and regions will produce different results. The SerpAPI integration is in progress.
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-12 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">Interest Over Time</h6>
									</div>
									<div class="card-body">
										<!-- Chart Type Selector -->
										<div class="mb-3">
											<label for="chartTypeSelector" class="form-label">Select Visualization Type:</label>
											<select class="form-select" id="chartTypeSelector" onchange="switchChartType()">
												<option value="line">Line Chart</option>
												<option value="bar">Bar Chart</option>
												<option value="pie">Pie Chart</option>
												<option value="area">Area Chart</option>
											</select>
										</div>

										<!-- Chart Containers -->
										<div id="lineChartContainer" class="chart-container">
											<canvas id="lineChart" height="300"></canvas>
										</div>

										<div id="barChartContainer" class="chart-container" style="display:none;">
											<canvas id="barChart" height="300"></canvas>
										</div>

										<div id="pieChartContainer" class="chart-container" style="display:none;">
											<canvas id="pieChart" height="300"></canvas>
										</div>

										<div id="areaChartContainer" class="chart-container" style="display:none;">
											<canvas id="areaChart" height="300"></canvas>
										</div>
									</div>
								</div>
							</div>

							<div class="col-md-6 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">Top Related Queries</h6>
									</div>
									<div class="card-body">
										{{ top_queries_html|safe }}
									</div>
								</div>
							</div>

							<div class="col-md-6 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">Rising Related Queries</h6>
									</div>
									<div class="card-body">
										{{ rising_queries_html|safe }}
									</div>
								</div>
							</div>

							<div class="col-12 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">
											{% if region == 'GLOBAL' %}
												Interest by Country
											{% else %}
												Interest by Region in {{ region|upper }}
											{% endif %}
										</h6>
									</div>
									<div class="card-body">
										{{ region_html|safe }}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- End Google Trends Results Section -->
				{% endif %}

					<hr>

				  <!--end stepper three-->

    </div>
  </main>
  <!--end main wrapper-->


    <!--start overlay-->
    <div class="overlay btn-toggle"></div>
    <!--end overlay-->

     <!--start footer-->
     <footer class="page-footer">
      <p class="mb-0">Copyright Â© 2024. All right reserved.</p>
    </footer>
    <!--top footer-->

  <!--bootstrap js-->
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

  <!--plugins-->
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <!--plugins-->
  <script src="{% static 'plugins/perfect-scrollbar/js/perfect-scrollbar.js' %}"></script>
  <script src="{% static 'plugins/metismenu/metisMenu.min.js' %}"></script>
  <script src="{% static 'plugins/bs-stepper/js/bs-stepper.min.js' %}"></script>
  <script src="{% static 'plugins/bs-stepper/js/main.js' %}"></script>
  <script src="{% static 'plugins/simplebar/js/simplebar.min.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>

  <!-- Initialize the stepper -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the BS Stepper
      var stepper = new Stepper(document.querySelector('#stepper1'), {
        linear: false
      });

      // Make the first step visible by default
      var firstPane = document.querySelector('#test-l-1');
      if (firstPane) {
        firstPane.classList.add('active', 'dstepper-block');
      }
    });
  </script>

  <!-- Add Chart.js and ApexCharts libraries -->
  <script src="{% static 'plugins/chartjs/js/chart.js' %}"></script>
  <script src="{% static 'plugins/apexchart/apexcharts.min.js' %}"></script>

  <!-- Chart Rendering Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Only initialize charts if we have results
      {% if has_results %}
        initializeCharts();
      {% endif %}
    });

    // Function to switch between chart types
    function switchChartType() {
      const chartType = document.getElementById('chartTypeSelector').value;

      // Hide all chart containers
      document.querySelectorAll('.chart-container').forEach(container => {
        container.style.display = 'none';
      });

      // Show the selected chart container
      document.getElementById(chartType + 'ChartContainer').style.display = 'block';
    }

    // Function to initialize all charts
    function initializeCharts() {
      // Sample data based on the search term
      // In a real implementation, this would come from the backend
      const labels = [];
      const values = [];

      // Generate appropriate time labels based on selected time range
      {% if has_results %}
        const timeRange = "{{ time_range }}";
        const numPoints = 10; // Number of data points to display

        // Generate labels based on time range
        if (timeRange.includes("1-m") || timeRange.includes("month")) {
          // Past month - show days with better distribution
          const today = new Date();
          const daysInMonth = 30;
          const interval = Math.max(1, Math.floor(daysInMonth / numPoints));

          for (let i = 0; i < numPoints; i++) {
            const date = new Date();
            date.setDate(today.getDate() - (daysInMonth - i * interval));
            labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
          }
        } else if (timeRange.includes("3-m")) {
          // Past 3 months - show weeks with better distribution
          const today = new Date();
          const daysIn3Months = 90;
          const interval = Math.max(1, Math.floor(daysIn3Months / numPoints));

          for (let i = 0; i < numPoints; i++) {
            const date = new Date();
            date.setDate(today.getDate() - (daysIn3Months - i * interval));
            labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
          }
        } else if (timeRange.includes("12-m") || timeRange.includes("year")) {
          // Past year - show months evenly distributed
          const today = new Date();
          const currentMonth = today.getMonth();
          const currentYear = today.getFullYear();

          for (let i = 0; i < numPoints; i++) {
            // Calculate month and year
            let monthOffset = (currentMonth - (numPoints - 1 - i)) % 12;
            if (monthOffset < 0) monthOffset += 12;

            let yearOffset = currentYear;
            if (currentMonth < (numPoints - 1 - i)) {
              yearOffset -= 1;
            }

            const date = new Date(yearOffset, monthOffset, 1);
            labels.push(date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }));
          }
        } else if (timeRange.includes("5-y")) {
          // Past 5 years - show 6-month periods as requested
          const today = new Date();
          const currentYear = today.getFullYear();
          const currentMonth = today.getMonth();
          const halfYear = currentMonth >= 6 ? 2 : 1; // 1 for Jan-Jun, 2 for Jul-Dec

          // Calculate how many 6-month periods we need to display
          const totalPeriods = 10; // 5 years * 2 periods per year

          for (let i = 0; i < Math.min(numPoints, totalPeriods); i++) {
            // Calculate which period to show, starting from the oldest
            const periodsAgo = totalPeriods - 1 - i;
            const yearOffset = Math.floor(periodsAgo / 2);
            const periodInYear = periodsAgo % 2 === 0 ? 1 : 2; // 1 for Jan-Jun, 2 for Jul-Dec

            const year = currentYear - 5 + yearOffset;
            const periodLabel = periodInYear === 1 ? "Jan-Jun" : "Jul-Dec";

            labels.push(`${year} ${periodLabel}`);
          }
        } else if (timeRange === "all") {
          // All time - show years with better distribution
          const today = new Date();
          const currentYear = today.getFullYear();
          const startYear = currentYear - 10; // Show last 10 years for "all time"

          for (let i = 0; i < numPoints; i++) {
            const year = startYear + i;
            labels.push(`${year}`);
          }
        } else {
          // Default fallback - just in case
          for (let i = 0; i < numPoints; i++) {
            labels.push(`Period ${i+1}`);
          }
        }

        // Generate random values for demonstration
        for (let i = 0; i < numPoints; i++) {
          // Generate a random value between 20 and 100
          values.push(Math.floor(Math.random() * 80) + 20);
        }

        // Initialize Line Chart
        initLineChart(labels, values);

        // Initialize Bar Chart
        initBarChart(labels, values);

        // Initialize Pie Chart
        initPieChart(labels, values);

        // Initialize Area Chart
        initAreaChart(labels, values);
      {% endif %}
    }

    // Initialize Line Chart
    function initLineChart(labels, values) {
      const ctx = document.getElementById('lineChart').getContext('2d');

      // Create gradient for line chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, '#ff6a00');
      gradientStroke.addColorStop(1, '#ee0979');

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '{{ search_term }}',
            data: values,
            backgroundColor: 'transparent',
            borderColor: gradientStroke,
            borderWidth: 3,
            pointBackgroundColor: gradientStroke,
            pointBorderColor: gradientStroke,
            pointHoverBackgroundColor: gradientStroke,
            pointHoverBorderColor: gradientStroke,
            pointRadius: 5,
            pointHoverRadius: 7,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Line Chart'
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              grid: {
                drawBorder: false
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    // Initialize Bar Chart
    function initBarChart(labels, values) {
      const ctx = document.getElementById('barChart').getContext('2d');

      // Create gradient for bar chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, '#005bea');
      gradientStroke.addColorStop(1, '#00c6fb');

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: '{{ search_term }}',
            data: values,
            backgroundColor: gradientStroke,
            borderColor: gradientStroke,
            borderWidth: 1,
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Bar Chart'
            }
          }
        }
      });
    }

    // Initialize Pie Chart
    function initPieChart(labels, values) {
      const ctx = document.getElementById('pieChart').getContext('2d');

      // Create a subset of data for the pie chart (last 5 points)
      const pieLabels = labels.slice(-5);
      const pieValues = values.slice(-5);

      // Define colors for pie chart
      const pieColors = [
        '#0d6efd',
        '#6f42c1',
        '#d63384',
        '#fd7e14',
        '#15ca20'
      ];

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: pieLabels,
          datasets: [{
            label: '{{ search_term }}',
            data: pieValues,
            backgroundColor: pieColors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Distribution ({{ time_range|title }}) - Pie Chart'
            }
          }
        }
      });
    }

    // Initialize Area Chart
    function initAreaChart(labels, values) {
      const ctx = document.getElementById('areaChart').getContext('2d');

      // Create gradient for area chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, 'rgba(2, 194, 122, 0.8)');
      gradientStroke.addColorStop(1, 'rgba(2, 194, 122, 0.1)');

      new Chart(ctx, {
        type: 'line', // Line chart with fill = area chart
        data: {
          labels: labels,
          datasets: [{
            label: '{{ search_term }}',
            data: values,
            fill: true,
            backgroundColor: gradientStroke,
            borderColor: '#02c27a',
            borderWidth: 2,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Area Chart'
            }
          }
        }
      });
    }
  </script>

  <!-- jQuery UI for autocomplete -->
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <!-- Search Term Autocomplete Script -->
  <script>
    $(document).ready(function() {
      // Popular search terms for suggestions
      const popularSearchTerms = [
        "Artificial Intelligence",
        "Machine Learning",
        "Data Science",
        "Python Programming",
        "JavaScript",
        "Web Development",
        "Mobile Apps",
        "Blockchain",
        "Cryptocurrency",
        "Bitcoin",
        "Ethereum",
        "NFT",
        "Cloud Computing",
        "AWS",
        "Azure",
        "Google Cloud",
        "Cybersecurity",
        "Remote Work",
        "Virtual Reality",
        "Augmented Reality",
        "Internet of Things",
        "5G Technology",
        "Electric Vehicles",
        "Tesla",
        "SpaceX",
        "NASA",
        "Climate Change",
        "Renewable Energy",
        "Solar Power",
        "Wind Energy",
        "COVID-19",
        "Vaccines",
        "Health Tech",
        "Fitness",
        "Nutrition",
        "Yoga",
        "Meditation",
        "Mental Health",
        "E-commerce",
        "Amazon",
        "Online Shopping",
        "Digital Marketing",
        "Social Media",
        "Facebook",
        "Instagram",
        "TikTok",
        "YouTube",
        "Streaming Services",
        "Netflix",
        "Disney Plus",
        "Gaming",
        "PlayStation",
        "Xbox",
        "Nintendo Switch",
        "Smartphones",
        "iPhone",
        "Samsung Galaxy",
        "Android",
        "iOS",
        "Laptops",
        "Smart Home",
        "Travel Destinations",
        "Tourism",
        "Hotels",
        "Airbnb",
        "Cooking",
        "Recipes",
        "Vegan",
        "Gluten Free",
        "Fashion Trends",
        "Sustainable Fashion",
        "Sports",
        "Football",
        "Basketball",
        "Tennis",
        "Olympics",
        "Music",
        "Movies",
        "TV Shows",
        "Books",
        "Education",
        "Online Courses",
        "Languages",
        "Photography",
        "Graphic Design",
        "Home Decor",
        "DIY Projects",
        "Gardening",
        "Pets",
        "Dogs",
        "Cats",
        "Parenting",
        "Baby Names",
        "Wedding Trends",
        "Finance",
        "Investing",
        "Stock Market",
        "Real Estate",
        "Housing Market",
        "Career Development",
        "Job Search",
        "Resume Tips",
        "Interview Questions"
      ];

      // Initialize autocomplete on search term input
      $("#search_term").autocomplete({
        source: function(request, response) {
          // Filter terms that match the current input
          const term = request.term.toLowerCase();
          const matches = popularSearchTerms.filter(item =>
            item.toLowerCase().includes(term)
          );

          // Return top 10 matches
          response(matches.slice(0, 10));
        },
        minLength: 2,  // Start showing suggestions after 2 characters
        delay: 300,    // Delay in milliseconds
        select: function(event, ui) {
          // Set the selected value in the input field
          $("#search_term").val(ui.item.value);
          return false;
        }
      }).autocomplete("instance")._renderItem = function(ul, item) {
        // Highlight the matching part of the suggestion
        const term = this.term.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        const re = new RegExp("(" + term + ")", "gi");
        const highlightedText = item.label.replace(re, "<strong>$1</strong>");

        // Return custom formatted list item
        return $("<li>")
          .append("<div>" + highlightedText + "</div>")
          .appendTo(ul);
      };
    });
  </script>

</body>

</html>
