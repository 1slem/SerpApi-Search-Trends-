{% load static %}
<!doctype html>
<html lang="en" data-bs-theme="blue-theme">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SerpAPI Trends | Form Wizard</title>
  <!--favicon-->
	<link rel="icon" href="{% static 'images/favicon-32x32.png' %}" type="image/png">
  <!-- loader-->
	<link href="{% static 'css/pace.min.css' %}" rel="stylesheet">
	<script src="{% static 'js/pace.min.js' %}"></script>

  <!--plugins-->
  <link href="{% static 'plugins/perfect-scrollbar/css/perfect-scrollbar.css' %}" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/metismenu/metisMenu.min.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/metismenu/mm-vertical.css' %}">
  <link rel="stylesheet" type="text/css" href="{% static 'plugins/simplebar/css/simplebar.css' %}">
  <link href="{% static 'plugins/perfect-scrollbar/css/perfect-scrollbar.css' %}" rel="stylesheet">
  <link href="{% static 'plugins/bs-stepper/css/bs-stepper.css' %}" rel="stylesheet">

  <!--bootstrap css-->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Material+Icons+Outlined" rel="stylesheet">
  <!--main css-->
  <link href="{% static 'css/bootstrap-extended.css' %}" rel="stylesheet">
  <link href="{% static 'css/main.css' %}" rel="stylesheet">
  <link href="{% static 'css/dark-theme.css' %}" rel="stylesheet">
  <link href="{% static 'css/blue-theme.css' %}" rel="stylesheet">
  <link href="{% static 'css/semi-dark.css' %}" rel="stylesheet">
  <link href="{% static 'css/bordered-theme.css' %}" rel="stylesheet">
  <link href="{% static 'css/responsive.css' %}" rel="stylesheet">

  <!-- jQuery UI CSS for autocomplete -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

  <!-- Custom styles for charts and autocomplete -->
  <style>
    .chart-container {
      position: relative;
      margin: auto;
      height: 350px;
      width: 100%;
    }

    #chartTypeSelector {
      max-width: 300px;
    }

    /* Add some animation for chart transitions */
    .chart-container {
      transition: opacity 0.3s ease-in-out;
    }

    /* Autocomplete styles */
    .ui-autocomplete {
      max-height: 200px;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 9999 !important;
      border-radius: 0 0 4px 4px;
      border: 1px solid #ddd;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    .ui-menu-item {
      padding: 8px 12px;
      border-bottom: 1px solid #f3f3f3;
    }

    .ui-menu-item:hover {
      background-color: #f8f9fa;
      cursor: pointer;
    }

    .ui-state-active,
    .ui-widget-content .ui-state-active {
      background-color: #0d6efd !important;
      border-color: #0d6efd !important;
      color: white !important;
    }

    .ui-helper-hidden-accessible {
      display: none;
    }

    /* Animation styles for charts */
    .chart-container {
      transition: all 0.3s ease-in-out;
      position: relative;
    }

    .chart-container.animating {
      position: relative;
    }

    .chart-container.animating::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(13, 110, 253, 0.1), rgba(13, 110, 253, 0.05));
      border-radius: 8px;
      z-index: 1;
      animation: pulse 2s infinite;
      pointer-events: none;
    }

    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 0.1; }
      100% { opacity: 0.3; }
    }

    /* Animation controls styling */
    .btn-group .btn {
      transition: all 0.2s ease-in-out;
    }

    .btn-group .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Progress bar animation */
    .progress-bar {
      transition: width 0.3s ease-in-out;
    }

    /* Trend evolution indicator */
    .trend-indicator {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      z-index: 10;
      transition: all 0.3s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .trend-indicator.trend-up {
      color: #28a745;
      border-left: 4px solid #28a745;
    }

    .trend-indicator.trend-down {
      color: #dc3545;
      border-left: 4px solid #dc3545;
    }

    .trend-indicator.trend-stable {
      color: #6c757d;
      border-left: 4px solid #6c757d;
    }

    /* Animation speed controls */
    .animation-speed-control {
      font-size: 0.8rem;
      margin-top: 5px;
    }

    .speed-slider {
      width: 100px;
      height: 4px;
    }

    /* Real-time indicators */
    .live-indicator {
      width: 8px;
      height: 8px;
      background-color: #28a745;
      border-radius: 50%;
      animation: livePulse 2s infinite;
    }

    @keyframes livePulse {
      0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        transform: scale(1);
      }
      50% {
        box-shadow: 0 0 0 8px rgba(40, 167, 69, 0);
        transform: scale(1.1);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        transform: scale(1);
      }
    }

    /* Real-time status badges */
    .badge.bg-success {
      animation: fadeInOut 2s infinite;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Real-time data panel */
    .card.border-success {
      border-width: 2px !important;
      box-shadow: 0 0 10px rgba(40, 167, 69, 0.2);
    }

    /* Real-time chart updates */
    .chart-updating {
      position: relative;
    }

    .chart-updating::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(40, 167, 69, 0.1), transparent);
      border-radius: 8px;
      animation: shimmer 2s infinite;
      pointer-events: none;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Connection status indicators */
    .connection-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8rem;
    }

    .connection-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: #dc3545;
    }

    .connection-dot.connected {
      background-color: #28a745;
      animation: connectedPulse 3s infinite;
    }

    @keyframes connectedPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>

</head>

<body>

  {% include 'components/header.html' %}

  {% include 'components/sidebar.html' %}


  <!--start main wrapper-->
  <main class="main-wrapper">
    <div class="main-content">
      <!--breadcrumb-->
				<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
					<div class="breadcrumb-title pe-3">Components</div>
					<div class="ps-3">
						<nav aria-label="breadcrumb">

						</nav>
					</div>
					<div class="ms-auto">
						<!-- Settings button removed -->
					</div>
				</div>
				<!--end breadcrumb-->



        <!--start stepper one-->

        <h6 class="text-uppercase">Non Linear</h6>
        <hr>
				<div id="stepper1" class="bs-stepper">
				  <div class="card">

					<div class="card-header">
						<div class="d-lg-flex flex-lg-row align-items-lg-center justify-content-lg-between" role="tablist">
							<div class="step" data-target="#test-l-1">
							  <div class="step-trigger" role="tab" id="stepper1trigger1" aria-controls="test-l-1">
								<div class="bs-stepper-circle"></div>
								<div class="">
									<h5 class="mb-0 steper-title">Search for trends</h5>

								</div>
							  </div>
							</div>

						  </div>
					 </div>
				    <div class="card-body">
					  <div class="bs-stepper-content">
						<form method="post" action="{% url 'search_trends' %}" id="trends-form">
						  {% csrf_token %}
						  <div id="test-l-1" role="tabpanel" class="bs-stepper-pane active dstepper-block" aria-labelledby="stepper1trigger1">
							<h5 class="mb-1">Search Trends with SerpAPI (Demo Mode)</h5>
							<p class="mb-4">Enter search terms and select a region to explore search trends data. Currently using demo data.</p>

							{% if error %}
							<div class="alert alert-danger" role="alert">
								<pre style="white-space: pre-wrap;">{{ error }}</pre>
							</div>
							{% endif %}

							{% if searches_left is not None %}
							<div class="alert {% if searches_left <= 1 %}alert-danger{% elif searches_left <= 2 %}alert-warning{% else %}alert-info{% endif %} mb-4">
								<div class="d-flex justify-content-between align-items-center">
									<div>
										<strong>Search Limit:</strong> You have used {{ search_count }} of {{ max_searches }} searches.
										{% if searches_left <= 0 %}
										<span class="d-block mt-1">You've reached your search limit. Please upgrade your plan to continue searching.</span>
										{% elif searches_left == 1 %}
										<span class="d-block mt-1">You have only 1 search remaining. Consider upgrading your plan.</span>
										{% else %}
										<span class="d-block mt-1">You have {{ searches_left }} searches remaining.</span>
										{% endif %}
									</div>
									<a href="{% url 'pricing_page' %}" class="btn btn-primary">Buy Plan</a>
								</div>
							</div>
							{% endif %}

							<div class="row g-3">
								<div class="col-12 col-lg-6">
									<label class="form-label">Search Term</label>
									<div class="position-relative">
										<input type="text" class="form-control" name="search_term" id="search_term" placeholder="Enter keyword or topic" autocomplete="off">
										<div id="search_suggestions" class="search-suggestions"></div>
									</div>
								</div>
								<div class="col-12 col-lg-6">
									<label for="region" class="form-label">Select Region</label>
									<select class="form-select" id="region" name="region" data-placeholder="Choose a region" >
										<option value="GLOBAL">Global</option>
										{% for country_code, country_name in countries %}
											<option value="{{ country_code }}">{{ country_name }}</option>
										{% endfor %}
									</select>
								</div>

								<div class="col-12 col-lg-6">
									<label for="time_range" class="form-label">Time Range</label>
									<select class="form-select" id="time_range" name="time_range">
										<option value="today 1-m">Past month</option>
										<option value="today 3-m">Past 3 months</option>
										<option value="today 12-m">Past year</option>
										<option value="today 5-y">Past 5 years</option>
										<option value="all">All time</option>
									</select>
								</div>

								<div class="col-12 col-lg-6">
									<label for="category" class="form-label">Platform</label>
									<select class="form-select" id="category" name="category">
										<option value="0">All platforms (web)</option>
										<option value="5">Web</option>
										<option value="7">News</option>
										<option value="12">Images</option>
										<option value="20">YouTube</option>
										<option value="30">Shopping</option>
									</select>
								</div>

								<div class="col-12">
									<button type="submit" id="search-button" class="btn btn-grd-primary px-4">Search Trends <i class="material-icons-outlined">trending_up</i></button>
								</div>
							</div><!---end row-->

						  </div>
						</form>
					  </div>

					</div>
				   </div>
				 </div>
				<!--end stepper one-->

				<!-- Loading Spinner (initially hidden) -->
				<div id="loading-spinner" class="card mt-4" style="display: none;">
					<div class="card-body text-center py-5">
						<div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
							<span class="visually-hidden">Loading...</span>
						</div>
						<p class="mt-3 mb-0">Searching for trends data...</p>
					</div>
				</div>

				{% if has_results %}
				<!-- Search Trends Results Section -->
				<div class="card mt-4">
					<div class="card-header">
						<h5 class="mb-0">Demo Results for "{{ search_term }}"</h5>
						<p class="mb-0">Region: {{ region }} | Time Range: {{ time_range }} | <span class="badge bg-warning">Demo Data</span></p>
					</div>
					<div class="alert alert-info mx-3 mt-3">
						<strong>Note:</strong> This is currently showing dynamically generated demo data based on your search term and region.
						Different combinations of search terms and regions will produce different results. The SerpAPI integration is in progress.
					</div>
					<div class="card-body">
						<div class="row">
							<div class="col-12 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">Interest Over Time</h6>
									</div>
									<div class="card-body">
										<!-- Chart Type Selector -->
										<div class="row mb-3">
											<div class="col-md-6">
												<label for="chartTypeSelector" class="form-label">Select Visualization Type:</label>
												<select class="form-select" id="chartTypeSelector" onchange="switchChartType()">
													<option value="line">Line Chart</option>
													<option value="bar">Bar Chart</option>
													<option value="pie">Pie Chart</option>
													<option value="area">Area Chart</option>
												</select>
											</div>
											<div class="col-md-6">
												<label class="form-label">Chart Controls:</label>
												<div class="d-flex gap-2 mb-2">
													<button type="button" class="btn btn-outline-primary btn-sm" id="playAnimation" title="Play time-lapse animation">
														<i class="material-icons-outlined">play_arrow</i> Play
													</button>
													<button type="button" class="btn btn-outline-secondary btn-sm" id="pauseAnimation" title="Pause animation" disabled>
														<i class="material-icons-outlined">pause</i> Pause
													</button>
													<button type="button" class="btn btn-outline-info btn-sm" id="resetAnimation" title="Reset to beginning">
														<i class="material-icons-outlined">replay</i> Reset
													</button>
												</div>
												<div class="d-flex gap-2">
													<button type="button" class="btn btn-outline-success btn-sm" id="startRealtime" title="Start real-time updates">
														<i class="material-icons-outlined">sensors</i> Live
													</button>
													<button type="button" class="btn btn-outline-danger btn-sm" id="stopRealtime" title="Stop real-time updates" disabled>
														<i class="material-icons-outlined">stop</i> Stop
													</button>
													<span class="badge bg-secondary ms-2" id="realtimeStatus">Offline</span>
												</div>
											</div>
										</div>

										<!-- Animation Progress Bar -->
										<div class="mb-3" id="animationProgress" style="display: none;">
											<div class="d-flex justify-content-between align-items-center mb-2">
												<small class="text-muted">Animation Progress</small>
												<small class="text-muted" id="animationStatus">Ready to play</small>
											</div>
											<div class="progress" style="height: 6px;">
												<div class="progress-bar bg-primary" role="progressbar" id="progressBar" style="width: 0%"></div>
											</div>
										</div>

										<!-- Real-time Data Panel -->
										<div class="mb-3" id="realtimePanel" style="display: none;">
											<div class="card border-success">
												<div class="card-body p-3">
													<div class="row align-items-center">
														<div class="col-md-3">
															<div class="d-flex align-items-center">
																<div class="live-indicator me-2"></div>
																<small class="text-success fw-bold">LIVE DATA</small>
															</div>
														</div>
														<div class="col-md-3">
															<small class="text-muted">Current Value:</small>
															<div class="fw-bold" id="currentValue">--</div>
														</div>
														<div class="col-md-3">
															<small class="text-muted">Trend:</small>
															<div class="fw-bold" id="currentTrend">--</div>
														</div>
														<div class="col-md-3">
															<small class="text-muted">Last Update:</small>
															<div class="small" id="lastUpdate">--</div>
														</div>
													</div>
												</div>
											</div>
										</div>

										<!-- Chart Containers -->
										<div id="lineChartContainer" class="chart-container">
											<div class="trend-indicator" id="lineTrendIndicator" style="display: none;">
												<span id="lineTrendText">Analyzing...</span>
											</div>
											<canvas id="lineChart" height="300"></canvas>
										</div>

										<div id="barChartContainer" class="chart-container" style="display:none;">
											<div class="trend-indicator" id="barTrendIndicator" style="display: none;">
												<span id="barTrendText">Analyzing...</span>
											</div>
											<canvas id="barChart" height="300"></canvas>
										</div>

										<div id="pieChartContainer" class="chart-container" style="display:none;">
											<div class="trend-indicator" id="pieTrendIndicator" style="display: none;">
												<span id="pieTrendText">Analyzing...</span>
											</div>
											<canvas id="pieChart" height="300"></canvas>
										</div>

										<div id="areaChartContainer" class="chart-container" style="display:none;">
											<div class="trend-indicator" id="areaTrendIndicator" style="display: none;">
												<span id="areaTrendText">Analyzing...</span>
											</div>
											<canvas id="areaChart" height="300"></canvas>
										</div>
									</div>
								</div>
							</div>

							<div class="col-md-6 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">Top Related Queries</h6>
									</div>
									<div class="card-body">
										{{ top_queries_html|safe }}
									</div>
								</div>
							</div>

							<div class="col-md-6 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">Rising Related Queries</h6>
									</div>
									<div class="card-body">
										{{ rising_queries_html|safe }}
									</div>
								</div>
							</div>

							<div class="col-12 mb-4">
								<div class="card">
									<div class="card-header">
										<h6 class="mb-0">
											{% if region == 'GLOBAL' %}
												Interest by Country
											{% else %}
												Interest by Region in {{ region|upper }}
											{% endif %}
										</h6>
									</div>
									<div class="card-body">
										{{ region_html|safe }}
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- End Google Trends Results Section -->
				{% endif %}

					<hr>

				  <!--end stepper three-->

    </div>
  </main>
  <!--end main wrapper-->


    <!--start overlay-->
    <div class="overlay btn-toggle"></div>
    <!--end overlay-->

     <!--start footer-->
     <footer class="page-footer">
      <p class="mb-0">Copyright Â© 2024. All right reserved.</p>
    </footer>
    <!--top footer-->

  <!--bootstrap js-->
  <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

  <!--plugins-->
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <!--plugins-->
  <script src="{% static 'plugins/perfect-scrollbar/js/perfect-scrollbar.js' %}"></script>
  <script src="{% static 'plugins/metismenu/metisMenu.min.js' %}"></script>
  <script src="{% static 'plugins/bs-stepper/js/bs-stepper.min.js' %}"></script>
  <script src="{% static 'plugins/bs-stepper/js/main.js' %}"></script>
  <script src="{% static 'plugins/simplebar/js/simplebar.min.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>

  <!-- Initialize the stepper -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize the BS Stepper
      var stepper = new Stepper(document.querySelector('#stepper1'), {
        linear: false
      });

      // Make the first step visible by default
      var firstPane = document.querySelector('#test-l-1');
      if (firstPane) {
        firstPane.classList.add('active', 'dstepper-block');
      }
    });
  </script>

  <!-- Add Chart.js and ApexCharts libraries -->
  <script src="{% static 'plugins/chartjs/js/chart.js' %}"></script>
  <script src="{% static 'plugins/apexchart/apexcharts.min.js' %}"></script>

  <!-- Chart Rendering Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Only initialize charts if we have results
      {% if has_results %}
        initializeCharts();
      {% endif %}
    });

    // Function to switch between chart types
    function switchChartType() {
      const chartType = document.getElementById('chartTypeSelector').value;

      // Hide all chart containers
      document.querySelectorAll('.chart-container').forEach(container => {
        container.style.display = 'none';
      });

      // Show the selected chart container
      document.getElementById(chartType + 'ChartContainer').style.display = 'block';
    }

    // Global variables for animation
    let animationInterval;
    let animationSpeed = 800; // milliseconds between frames
    let isAnimating = false;
    let currentAnimationStep = 0;
    let totalAnimationSteps = 0;
    let chartInstances = {};

    // Function to initialize all charts
    function initializeCharts() {
      // Sample data based on the search term
      // In a real implementation, this would come from the backend
      const labels = [];
      const values = [];

      // Generate appropriate time labels based on selected time range
      {% if has_results %}
        const timeRange = "{{ time_range }}";
        const numPoints = 10; // Number of data points to display
        totalAnimationSteps = numPoints;

        // Generate labels based on time range
        if (timeRange.includes("1-m") || timeRange.includes("month")) {
          // Past month - show days with better distribution
          const today = new Date();
          const daysInMonth = 30;
          const interval = Math.max(1, Math.floor(daysInMonth / numPoints));

          for (let i = 0; i < numPoints; i++) {
            const date = new Date();
            date.setDate(today.getDate() - (daysInMonth - i * interval));
            labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
          }
        } else if (timeRange.includes("3-m")) {
          // Past 3 months - show weeks with better distribution
          const today = new Date();
          const daysIn3Months = 90;
          const interval = Math.max(1, Math.floor(daysIn3Months / numPoints));

          for (let i = 0; i < numPoints; i++) {
            const date = new Date();
            date.setDate(today.getDate() - (daysIn3Months - i * interval));
            labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
          }
        } else if (timeRange.includes("12-m") || timeRange.includes("year")) {
          // Past year - show months evenly distributed
          const today = new Date();
          const currentMonth = today.getMonth();
          const currentYear = today.getFullYear();

          for (let i = 0; i < numPoints; i++) {
            // Calculate month and year
            let monthOffset = (currentMonth - (numPoints - 1 - i)) % 12;
            if (monthOffset < 0) monthOffset += 12;

            let yearOffset = currentYear;
            if (currentMonth < (numPoints - 1 - i)) {
              yearOffset -= 1;
            }

            const date = new Date(yearOffset, monthOffset, 1);
            labels.push(date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }));
          }
        } else if (timeRange.includes("5-y")) {
          // Past 5 years - show 6-month periods as requested
          const today = new Date();
          const currentYear = today.getFullYear();
          const currentMonth = today.getMonth();
          const halfYear = currentMonth >= 6 ? 2 : 1; // 1 for Jan-Jun, 2 for Jul-Dec

          // Calculate how many 6-month periods we need to display
          const totalPeriods = 10; // 5 years * 2 periods per year

          for (let i = 0; i < Math.min(numPoints, totalPeriods); i++) {
            // Calculate which period to show, starting from the oldest
            const periodsAgo = totalPeriods - 1 - i;
            const yearOffset = Math.floor(periodsAgo / 2);
            const periodInYear = periodsAgo % 2 === 0 ? 1 : 2; // 1 for Jan-Jun, 2 for Jul-Dec

            const year = currentYear - 5 + yearOffset;
            const periodLabel = periodInYear === 1 ? "Jan-Jun" : "Jul-Dec";

            labels.push(`${year} ${periodLabel}`);
          }
        } else if (timeRange === "all") {
          // All time - show years with better distribution
          const today = new Date();
          const currentYear = today.getFullYear();
          const startYear = currentYear - 10; // Show last 10 years for "all time"

          for (let i = 0; i < numPoints; i++) {
            const year = startYear + i;
            labels.push(`${year}`);
          }
        } else {
          // Default fallback - just in case
          for (let i = 0; i < numPoints; i++) {
            labels.push(`Period ${i+1}`);
          }
        }

        // Generate random values for demonstration
        for (let i = 0; i < numPoints; i++) {
          // Generate a random value between 20 and 100
          values.push(Math.floor(Math.random() * 80) + 20);
        }

        // Store data globally for animations
        window.chartData = { labels, values };

        // Initialize Animated Charts
        initAnimatedLineChart(labels, values);
        initAnimatedBarChart(labels, values);
        initAnimatedPieChart(labels, values);
        initAnimatedAreaChart(labels, values);

        // Setup animation controls
        setupAnimationControls();

        // Setup real-time controls
        setupRealtimeControls();
      {% endif %}
    }

    // Initialize Line Chart
    function initLineChart(labels, values) {
      const ctx = document.getElementById('lineChart').getContext('2d');

      // Create gradient for line chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, '#ff6a00');
      gradientStroke.addColorStop(1, '#ee0979');

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: '{{ search_term }}',
            data: values,
            backgroundColor: 'transparent',
            borderColor: gradientStroke,
            borderWidth: 3,
            pointBackgroundColor: gradientStroke,
            pointBorderColor: gradientStroke,
            pointHoverBackgroundColor: gradientStroke,
            pointHoverBorderColor: gradientStroke,
            pointRadius: 5,
            pointHoverRadius: 7,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Line Chart'
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              grid: {
                drawBorder: false
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    // Initialize Bar Chart
    function initBarChart(labels, values) {
      const ctx = document.getElementById('barChart').getContext('2d');

      // Create gradient for bar chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, '#005bea');
      gradientStroke.addColorStop(1, '#00c6fb');

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: '{{ search_term }}',
            data: values,
            backgroundColor: gradientStroke,
            borderColor: gradientStroke,
            borderWidth: 1,
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Bar Chart'
            }
          }
        }
      });
    }

    // Initialize Pie Chart
    function initPieChart(labels, values) {
      const ctx = document.getElementById('pieChart').getContext('2d');

      // Create a subset of data for the pie chart (last 5 points)
      const pieLabels = labels.slice(-5);
      const pieValues = values.slice(-5);

      // Define colors for pie chart
      const pieColors = [
        '#0d6efd',
        '#6f42c1',
        '#d63384',
        '#fd7e14',
        '#15ca20'
      ];

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: pieLabels,
          datasets: [{
            label: '{{ search_term }}',
            data: pieValues,
            backgroundColor: pieColors,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Distribution ({{ time_range|title }}) - Pie Chart'
            }
          }
        }
      });
    }

    // Initialize Area Chart
    function initAreaChart(labels, values) {
      const ctx = document.getElementById('areaChart').getContext('2d');

      // Create gradient for area chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, 'rgba(2, 194, 122, 0.8)');
      gradientStroke.addColorStop(1, 'rgba(2, 194, 122, 0.1)');

      new Chart(ctx, {
        type: 'line', // Line chart with fill = area chart
        data: {
          labels: labels,
          datasets: [{
            label: '{{ search_term }}',
            data: values,
            fill: true,
            backgroundColor: gradientStroke,
            borderColor: '#02c27a',
            borderWidth: 2,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Area Chart'
            }
          }
        }
      });
    }

    // Animated Chart Functions
    function initAnimatedLineChart(labels, values) {
      const ctx = document.getElementById('lineChart').getContext('2d');

      // Create gradient for line chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, '#ff6a00');
      gradientStroke.addColorStop(1, '#ee0979');

      chartInstances.line = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '{{ search_term }}',
            data: [],
            backgroundColor: 'transparent',
            borderColor: gradientStroke,
            borderWidth: 3,
            pointBackgroundColor: gradientStroke,
            pointBorderColor: gradientStroke,
            pointHoverBackgroundColor: gradientStroke,
            pointHoverBorderColor: gradientStroke,
            pointRadius: 5,
            pointHoverRadius: 7,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Animated Line Chart'
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              grid: {
                drawBorder: false
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    function initAnimatedBarChart(labels, values) {
      const ctx = document.getElementById('barChart').getContext('2d');

      // Create gradient for bar chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, '#005bea');
      gradientStroke.addColorStop(1, '#00c6fb');

      chartInstances.bar = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: '{{ search_term }}',
            data: [],
            backgroundColor: gradientStroke,
            borderColor: gradientStroke,
            borderWidth: 1,
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Animated Bar Chart'
            }
          }
        }
      });
    }

    function initAnimatedPieChart(labels, values) {
      const ctx = document.getElementById('pieChart').getContext('2d');

      // Define colors for pie chart
      const pieColors = [
        '#0d6efd', '#6f42c1', '#d63384', '#fd7e14', '#15ca20',
        '#20c997', '#ffc107', '#dc3545', '#6c757d', '#f8f9fa'
      ];

      chartInstances.pie = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: [],
          datasets: [{
            label: '{{ search_term }}',
            data: [],
            backgroundColor: pieColors,
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Distribution ({{ time_range|title }}) - Animated Pie Chart'
            }
          }
        }
      });
    }

    function initAnimatedAreaChart(labels, values) {
      const ctx = document.getElementById('areaChart').getContext('2d');

      // Create gradient for area chart
      const gradientStroke = ctx.createLinearGradient(0, 0, 0, 300);
      gradientStroke.addColorStop(0, 'rgba(2, 194, 122, 0.8)');
      gradientStroke.addColorStop(1, 'rgba(2, 194, 122, 0.1)');

      chartInstances.area = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '{{ search_term }}',
            data: [],
            fill: true,
            backgroundColor: gradientStroke,
            borderColor: '#02c27a',
            borderWidth: 2,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          animation: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            title: {
              display: true,
              text: 'Interest Over Time ({{ time_range|title }}) - Animated Area Chart'
            }
          }
        }
      });
    }

    // Animation Control Functions
    function setupAnimationControls() {
      const playBtn = document.getElementById('playAnimation');
      const pauseBtn = document.getElementById('pauseAnimation');
      const resetBtn = document.getElementById('resetAnimation');
      const progressBar = document.getElementById('progressBar');
      const animationStatus = document.getElementById('animationStatus');
      const animationProgress = document.getElementById('animationProgress');

      playBtn.addEventListener('click', startAnimation);
      pauseBtn.addEventListener('click', pauseAnimation);
      resetBtn.addEventListener('click', resetAnimation);

      // Show animation controls
      animationProgress.style.display = 'block';
    }

    function startAnimation() {
      if (isAnimating) return;

      isAnimating = true;
      document.getElementById('playAnimation').disabled = true;
      document.getElementById('pauseAnimation').disabled = false;
      document.getElementById('animationStatus').textContent = 'Playing animation...';

      // Add animating class to containers
      document.querySelectorAll('.chart-container').forEach(container => {
        container.classList.add('animating');
      });

      animationInterval = setInterval(() => {
        if (currentAnimationStep >= totalAnimationSteps) {
          completeAnimation();
          return;
        }

        // Update all charts with new data point
        updateChartsWithStep(currentAnimationStep);

        // Update progress
        const progress = ((currentAnimationStep + 1) / totalAnimationSteps) * 100;
        document.getElementById('progressBar').style.width = progress + '%';

        // Update trend indicators
        updateTrendIndicators(currentAnimationStep);

        currentAnimationStep++;
      }, animationSpeed);
    }

    function pauseAnimation() {
      if (!isAnimating) return;

      clearInterval(animationInterval);
      isAnimating = false;
      document.getElementById('playAnimation').disabled = false;
      document.getElementById('pauseAnimation').disabled = true;
      document.getElementById('animationStatus').textContent = 'Animation paused';

      // Remove animating class
      document.querySelectorAll('.chart-container').forEach(container => {
        container.classList.remove('animating');
      });
    }

    function resetAnimation() {
      pauseAnimation();
      currentAnimationStep = 0;
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('animationStatus').textContent = 'Ready to play';

      // Reset all charts
      Object.keys(chartInstances).forEach(chartType => {
        chartInstances[chartType].data.labels = [];
        chartInstances[chartType].data.datasets[0].data = [];
        chartInstances[chartType].update('none');
      });

      // Hide trend indicators
      document.querySelectorAll('.trend-indicator').forEach(indicator => {
        indicator.style.display = 'none';
      });
    }

    function completeAnimation() {
      clearInterval(animationInterval);
      isAnimating = false;
      document.getElementById('playAnimation').disabled = false;
      document.getElementById('pauseAnimation').disabled = true;
      document.getElementById('animationStatus').textContent = 'Animation complete';
      document.getElementById('progressBar').style.width = '100%';

      // Remove animating class
      document.querySelectorAll('.chart-container').forEach(container => {
        container.classList.remove('animating');
      });

      // Show final trend analysis
      showFinalTrendAnalysis();
    }

    function updateChartsWithStep(step) {
      const { labels, values } = window.chartData;

      // Add next data point to each chart
      Object.keys(chartInstances).forEach(chartType => {
        const chart = chartInstances[chartType];

        if (step < labels.length) {
          chart.data.labels.push(labels[step]);

          if (chartType === 'pie') {
            // For pie chart, show cumulative data
            chart.data.datasets[0].data.push(values[step]);
          } else {
            chart.data.datasets[0].data.push(values[step]);
          }

          chart.update('none');
        }
      });
    }

    function updateTrendIndicators(step) {
      if (step < 2) return; // Need at least 2 points to determine trend

      const { values } = window.chartData;
      const currentValue = values[step];
      const previousValue = values[step - 1];

      let trendClass, trendText;

      if (currentValue > previousValue * 1.05) {
        trendClass = 'trend-up';
        trendText = 'â†— Trending Up';
      } else if (currentValue < previousValue * 0.95) {
        trendClass = 'trend-down';
        trendText = 'â†˜ Trending Down';
      } else {
        trendClass = 'trend-stable';
        trendText = 'â†’ Stable';
      }

      // Update all visible trend indicators
      const activeContainer = document.querySelector('.chart-container:not([style*="display: none"])');
      if (activeContainer) {
        const indicator = activeContainer.querySelector('.trend-indicator');
        const textElement = indicator.querySelector('span');

        indicator.className = `trend-indicator ${trendClass}`;
        textElement.textContent = trendText;
        indicator.style.display = 'block';
      }
    }

    function showFinalTrendAnalysis() {
      const { values } = window.chartData;
      const firstValue = values[0];
      const lastValue = values[values.length - 1];
      const change = ((lastValue - firstValue) / firstValue * 100).toFixed(1);

      let finalTrendClass, finalTrendText;

      if (change > 5) {
        finalTrendClass = 'trend-up';
        finalTrendText = `ðŸ“ˆ Overall Growth: +${change}%`;
      } else if (change < -5) {
        finalTrendClass = 'trend-down';
        finalTrendText = `ðŸ“‰ Overall Decline: ${change}%`;
      } else {
        finalTrendClass = 'trend-stable';
        finalTrendText = `ðŸ“Š Stable Trend: ${change}%`;
      }

      // Show final analysis on active chart
      const activeContainer = document.querySelector('.chart-container:not([style*="display: none"])');
      if (activeContainer) {
        const indicator = activeContainer.querySelector('.trend-indicator');
        const textElement = indicator.querySelector('span');

        indicator.className = `trend-indicator ${finalTrendClass}`;
        textElement.textContent = finalTrendText;
        indicator.style.display = 'block';
      }
    }

    // Real-time update variables
    let realtimeInterval;
    let isRealtimeActive = false;
    let realtimeUpdateCount = 0;

    // Real-time control functions
    function startRealtime() {
      if (isRealtimeActive) return;

      isRealtimeActive = true;
      realtimeUpdateCount = 0;

      // Update UI
      document.getElementById('startRealtime').disabled = true;
      document.getElementById('stopRealtime').disabled = false;
      document.getElementById('realtimeStatus').textContent = 'Live';
      document.getElementById('realtimeStatus').className = 'badge bg-success ms-2';
      document.getElementById('realtimePanel').style.display = 'block';

      // Start real-time updates every 3 seconds
      realtimeInterval = setInterval(updateRealtimeData, 3000);

      // Initial update
      updateRealtimeData();

      console.log('Real-time updates started');
    }

    function stopRealtime() {
      if (!isRealtimeActive) return;

      isRealtimeActive = false;
      clearInterval(realtimeInterval);

      // Update UI
      document.getElementById('startRealtime').disabled = false;
      document.getElementById('stopRealtime').disabled = true;
      document.getElementById('realtimeStatus').textContent = 'Offline';
      document.getElementById('realtimeStatus').className = 'badge bg-secondary ms-2';
      document.getElementById('realtimePanel').style.display = 'none';

      // Remove chart updating effects
      document.querySelectorAll('.chart-container').forEach(container => {
        container.classList.remove('chart-updating');
      });

      console.log('Real-time updates stopped');
    }

    function updateRealtimeData() {
      if (!isRealtimeActive) return;

      realtimeUpdateCount++;

      // Generate new random data point
      const newValue = Math.floor(Math.random() * 80) + 20;
      const currentTime = new Date();
      const timeLabel = currentTime.toLocaleTimeString();

      // Update current value display
      document.getElementById('currentValue').textContent = newValue;
      document.getElementById('lastUpdate').textContent = currentTime.toLocaleTimeString();

      // Calculate trend
      const { values } = window.chartData;
      if (values && values.length > 0) {
        const lastValue = values[values.length - 1];
        let trendText, trendClass;

        if (newValue > lastValue * 1.05) {
          trendText = 'â†— Rising';
          trendClass = 'text-success';
        } else if (newValue < lastValue * 0.95) {
          trendText = 'â†˜ Falling';
          trendClass = 'text-danger';
        } else {
          trendText = 'â†’ Stable';
          trendClass = 'text-muted';
        }

        const trendElement = document.getElementById('currentTrend');
        trendElement.textContent = trendText;
        trendElement.className = `fw-bold ${trendClass}`;
      }

      // Add visual updating effect to charts
      document.querySelectorAll('.chart-container').forEach(container => {
        container.classList.add('chart-updating');
        setTimeout(() => {
          container.classList.remove('chart-updating');
        }, 2000);
      });

      // Update charts with new data point
      updateChartsRealtime(newValue, timeLabel);

      console.log(`Real-time update #${realtimeUpdateCount}: ${newValue} at ${timeLabel}`);
    }

    function updateChartsRealtime(newValue, timeLabel) {
      // Update all chart instances with new data
      Object.keys(chartInstances).forEach(chartType => {
        const chart = chartInstances[chartType];

        if (chart && chart.data) {
          // Add new data point
          chart.data.labels.push(timeLabel);
          chart.data.datasets[0].data.push(newValue);

          // Keep only last 10 data points for real-time view
          if (chart.data.labels.length > 10) {
            chart.data.labels.shift();
            chart.data.datasets[0].data.shift();
          }

          // Update chart without animation
          chart.update('none');
        }
      });

      // Update global data for consistency
      if (window.chartData) {
        window.chartData.values.push(newValue);
        window.chartData.labels.push(timeLabel);

        // Keep only last 10 points
        if (window.chartData.values.length > 10) {
          window.chartData.values.shift();
          window.chartData.labels.shift();
        }
      }
    }

    // Setup real-time controls
    function setupRealtimeControls() {
      document.getElementById('startRealtime').addEventListener('click', startRealtime);
      document.getElementById('stopRealtime').addEventListener('click', stopRealtime);

      // Stop real-time when animation starts
      document.getElementById('playAnimation').addEventListener('click', () => {
        if (isRealtimeActive) {
          stopRealtime();
        }
      });
    }
  </script>

  <!-- jQuery UI for autocomplete -->
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

  <!-- Loading Spinner Script -->
  <script>
    $(document).ready(function() {
      // Show loading spinner when form is submitted
      $('#trends-form').on('submit', function() {
        // Hide the form inputs
        $('#search-button').prop('disabled', true);

        // Show the loading spinner
        $('#loading-spinner').fadeIn();

        // Allow the form to submit
        return true;
      });
    });
  </script>

  <!-- Search Term Autocomplete Script -->
  <script>
    $(document).ready(function() {
      // Popular search terms for suggestions
      const popularSearchTerms = [
        "Artificial Intelligence",
        "Machine Learning",
        "Data Science",
        "Python Programming",
        "JavaScript",
        "Web Development",
        "Mobile Apps",
        "Blockchain",
        "Cryptocurrency",
        "Bitcoin",
        "Ethereum",
        "NFT",
        "Cloud Computing",
        "AWS",
        "Azure",
        "Google Cloud",
        "Cybersecurity",
        "Remote Work",
        "Virtual Reality",
        "Augmented Reality",
        "Internet of Things",
        "5G Technology",
        "Electric Vehicles",
        "Tesla",
        "SpaceX",
        "NASA",
        "Climate Change",
        "Renewable Energy",
        "Solar Power",
        "Wind Energy",
        "COVID-19",
        "Vaccines",
        "Health Tech",
        "Fitness",
        "Nutrition",
        "Yoga",
        "Meditation",
        "Mental Health",
        "E-commerce",
        "Amazon",
        "Online Shopping",
        "Digital Marketing",
        "Social Media",
        "Facebook",
        "Instagram",
        "TikTok",
        "YouTube",
        "Streaming Services",
        "Netflix",
        "Disney Plus",
        "Gaming",
        "PlayStation",
        "Xbox",
        "Nintendo Switch",
        "Smartphones",
        "iPhone",
        "Samsung Galaxy",
        "Android",
        "iOS",
        "Laptops",
        "Smart Home",
        "Travel Destinations",
        "Tourism",
        "Hotels",
        "Airbnb",
        "Cooking",
        "Recipes",
        "Vegan",
        "Gluten Free",
        "Fashion Trends",
        "Sustainable Fashion",
        "Sports",
        "Football",
        "Basketball",
        "Tennis",
        "Olympics",
        "Music",
        "Movies",
        "TV Shows",
        "Books",
        "Education",
        "Online Courses",
        "Languages",
        "Photography",
        "Graphic Design",
        "Home Decor",
        "DIY Projects",
        "Gardening",
        "Pets",
        "Dogs",
        "Cats",
        "Parenting",
        "Baby Names",
        "Wedding Trends",
        "Finance",
        "Investing",
        "Stock Market",
        "Real Estate",
        "Housing Market",
        "Career Development",
        "Job Search",
        "Resume Tips",
        "Interview Questions"
      ];

      // Initialize autocomplete on search term input
      $("#search_term").autocomplete({
        source: function(request, response) {
          // Filter terms that match the current input
          const term = request.term.toLowerCase();
          const matches = popularSearchTerms.filter(item =>
            item.toLowerCase().includes(term)
          );

          // Return top 10 matches
          response(matches.slice(0, 10));
        },
        minLength: 2,  // Start showing suggestions after 2 characters
        delay: 300,    // Delay in milliseconds
        select: function(event, ui) {
          // Set the selected value in the input field
          $("#search_term").val(ui.item.value);
          return false;
        }
      }).autocomplete("instance")._renderItem = function(ul, item) {
        // Highlight the matching part of the suggestion
        const term = this.term.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        const re = new RegExp("(" + term + ")", "gi");
        const highlightedText = item.label.replace(re, "<strong>$1</strong>");

        // Return custom formatted list item
        return $("<li>")
          .append("<div>" + highlightedText + "</div>")
          .appendTo(ul);
      };
    });


  </script>



</body>

</html>
